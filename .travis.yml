---
#
# Ansible managed
#
language: python

os: linux
dist: xenial

python:
  - "3.8"

services:
  - docker

env:
  global:
    namespace="robertdebock"
  jobs:
    - image="alpine" tag="latest"
    - image="alpine" tag="edge"
    - image="amazonlinux" tag="1"
    - image="centos" tag="7"
    - image="centos" tag="latest"
    - image="debian" tag="latest"
    - image="debian" tag="bullseye"
    - image="fedora" tag="32"
    - image="fedora" tag="latest"
    - image="fedora" tag="rawhide"
    - image="opensuse" tag="latest"
    - image="ubuntu" tag="latest"
    - image="ubuntu" tag="bionic"
    - image="ubuntu" tag="xenial"

cache:
  - pip

install:
  - pip install --upgrade pip
  - pip install tox

script:
  - function retry { counter=0 ; until "$@" ; do exit=$? ; counter=$(($counter + 1)) ; if [ $counter -ge 3 ] ; then return $exit ; fi ; done ; return 0; } ; retry tox

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    secure: "v/YKMf5Kn7hd1HM3nSGemM8EOfUohJ+z7s+Pa8LXO2ZADjvYSC5mleDBnPp3AN/HHDUc1CE9S6Awpa864oibfQvv6dEkk1fVHgr/CG8ynEH6qlqfx5bfcDzyp4kTYmIn1KJC58MnuhNNG4GbNNeMpOx+Yv9nmbU2hBPC+4lKRNIjTrjjVjDF3q3RtwgI9v63t09WlfmiLZFVnYi9uVNu3ZXyNfm8L6A8AUwBZ0hbct30zz/qu0SO+pzQBRaDh9YcDuoTPx4UBBD1SIS/nRVRz7pRHgIiKYO8zqDuMJJUNhdGX6tX6LFWAap3M9sn3NRLl7Kg3CrbbulSrgtF/aczBNkvK1gYg6fTij49hHhWmuc48D7GzjFI3YTfN2DCQRXGFe5SzvlzykvRau9wrklNPjXb4TZo4997I0Xh5dNUQ6W7Y//AhQ1w396K9lP9ERgS6x1qCA/cSKT4NhfM15uBscL/AV+DhI8w3kqzdoErb+f1mgG8xZuaYueef2m67yGkeRIh4sT78U/9dYwlNdFHdwtR4op4MjBNmhkcA0dJ9eQuKoo2nxb+ZTsaI85UVofXlNqcWK7stK/x2J1sv+nxr+NrQm1xh3mZHxh4OGw7icrgR1PGDgGvKJFZDoPlscfk3mOQ4MmEfo01Hol4kvWNUFSl5oiKj9zhAXRhW5uEaaQ="
    on_success: change
    template: "%{result}: %{repository_slug}@%{branch}, build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>)"
  email: false
